<!DOCTYPE html>
<html lang="ko">
<head>
<title>폼당폼당</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no, address=no, email=no">
<link href="../css/common.css" type="text/css" rel="stylesheet">
<link href="../css/admin.css" type="text/css" rel="stylesheet">
<script src="../js/jquery-1.12.4.min.js"></script>
<script src="../js/nice-select/jquery.nice-select.js"></script>
</head>
<body>
<div id="wrap">
	<header id="header" class="admin_header">
        <div class="mob-head">
            <h1 class="logo"><a href="./"><img src="../image/common/logo_vertical.png" alt="폼당폼당" class="w4em"></a></h1>
            <p class="bt-group"><a href="group_write.html">폼당 그룹결성 <i class="ico"></i></a></p>
            <nav class="gnb">
                <ul>
                    <li><a href="write.html"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path style="fill:currentColor" fill-rule="evenodd" d="M5.54 19.52c-.61 0-1.18-.21-1.59-.6-.52-.49-.77-1.23-.68-2.03l.37-3.24c.07-.61.44-1.42.87-1.86l6.837-7.237a.707.707 0 0 1 .025-.026L12.72 3.1c2.05-2.17 4.19-2.23 6.36-.18s2.23 4.19.18 6.36l-8.21 8.69c-.42.45-1.2.87-1.81.97l-3.22.55-.177.013c-.102.009-.2.017-.303.017Zm.06-6.71 5.918-6.272a6.86 6.86 0 0 0 4.353 4.125L9.95 16.93c-.2.21-.68.47-.97.52L5.76 18c-.33.05-.6-.01-.78-.18-.18-.17-.26-.44-.22-.77l.37-3.24c.04-.29.27-.79.47-1Zm12.56-4.57-1.105 1.17a5.372 5.372 0 0 1-4.342-4.137L13.81 4.11c.68-.72 1.35-1.2 2.12-1.2.62 0 1.31.32 2.11 1.09 1.81 1.7 1.36 2.92.12 4.24ZM3 22.75h18c.41 0 .75-.34.75-.75s-.34-.75-.75-.75H3c-.41 0-.75.34-.75.75s.34.75.75.75Z" clip-rule="evenodd"/></svg> 폼 작성하기</a></li>
                    <li><a href="index.html"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path style="fill:currentColor" fill-rule="evenodd" d="M3.47 7.03c.15.15.34.22.53.22s.38-.07.53-.22l3-3c.29-.29.29-.77 0-1.06a.754.754 0 0 0-1.06 0L4 5.44l-.47-.47a.754.754 0 0 0-1.06 0c-.29.29-.29.77 0 1.06l1 1ZM21 6.25H11c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h10c.41 0 .75.34.75.75s-.34.75-.75.75Zm-10 7h10c.41 0 .75-.34.75-.75s-.34-.75-.75-.75H11c-.41 0-.75.34-.75.75s.34.75.75.75Zm0 7h10c.41 0 .75-.34.75-.75s-.34-.75-.75-.75H11c-.41 0-.75.34-.75.75s.34.75.75.75Zm-7-6c-.19 0-.38-.07-.53-.22l-1-1a.754.754 0 0 1 0-1.06c.29-.29.77-.29 1.06 0l.47.47 2.47-2.47c.29-.29.77-.29 1.06 0 .29.29.29.77 0 1.06l-3 3c-.15.15-.34.22-.53.22Zm-.53 6.78c.15.15.34.22.53.22s.38-.07.53-.22l3-3c.29-.29.29-.77 0-1.06a.754.754 0 0 0-1.06 0L4 19.44l-.47-.47a.754.754 0 0 0-1.06 0c-.29.29-.29.77 0 1.06l1 1Z" clip-rule="evenodd"/></svg> 내 폼 보기</a></li>
                    <!-- <li><a href="answer_status_list.html"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path style="fill:currentColor" fill-rule="evenodd" d="M15 22.75H9c-5.43 0-7.75-2.32-7.75-7.75V9c0-5.43 2.32-7.75 7.75-7.75h6c5.43 0 7.75 2.32 7.75 7.75v6c0 5.43-2.32 7.75-7.75 7.75ZM2.752 8.76 2.75 9v6c0 4.61 1.64 6.25 6.25 6.25h6c4.61 0 6.25-1.64 6.25-6.25V9c0-.084 0-.168-.002-.25l-18.496.01Zm.095-1.5C3.258 3.97 5.025 2.75 9 2.75h6c3.97 0 5.738 1.217 6.152 4.5l-18.305.01ZM14.54 17.34c.13.26.39.41.67.41.11 0 .22-.03.34-.1a4.91 4.91 0 0 0 1.91-1.68c.4-.6.4-1.37 0-1.97-.48-.72-1.14-1.3-1.91-1.69a.763.763 0 0 0-1.01.34c-.18.37-.03.82.34 1.01.54.27 1 .68 1.33 1.18.06.1.06.22 0 .31-.33.5-.79.91-1.33 1.18-.38.19-.53.64-.34 1.01Zm-5.87.33c.1.05.22.08.33.08.27 0 .54-.15.68-.39.18-.37.03-.82-.34-1.01-.54-.27-1-.68-1.33-1.18a.29.29 0 0 1 0-.31c.33-.5.79-.91 1.33-1.18.38-.19.53-.64.34-1.01a.754.754 0 0 0-1.01-.34c-.77.38-1.43.96-1.91 1.68-.4.6-.4 1.37 0 1.97.48.72 1.14 1.3 1.91 1.69Z" clip-rule="evenodd"/></svg> API 설정하기</a></li> -->
                    <!-- <li><a href="javascript:alert('링크를 연결하세요!');"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path style="fill:currentColor" fill-rule="evenodd" d="M9.881 5.484a.47.47 0 0 0 .469-.134c.13-.12.18-.31.13-.49l-.4-1.36.4-1.36a.5.5 0 0 0-.13-.49.494.494 0 0 0-.49-.13l-1.36.4-1.36-.4a.5.5 0 0 0-.49.13c-.13.12-.18.31-.13.49l.4 1.36-.4 1.36c-.05.18 0 .36.13.49.12.13.31.18.49.13l1.36-.4 1.36.4.021.004ZM8.62 4.076c-.041-.009-.076-.016-.12-.016-.042 0-.077.007-.118.016l-.021.004-.62.18.18-.62c.03-.09.03-.19 0-.28l-.18-.62.62.18c.09.03.19.03.28 0l.62-.18-.18.62c-.03.09-.03.19 0 .28l.18.62-.62-.18-.021-.004ZM4.999 21.87c-.74 0-1.47-.28-2.03-.84-.54-.54-.84-1.26-.84-2.03 0-.77.3-1.49.84-2.03l13-13a2.873 2.873 0 0 1 4.06 0c.54.54.84 1.26.84 2.03 0 .77-.3 1.49-.84 2.03l-1.484 1.484-.005.006-.006.006L7.03 21.03c-.56.56-1.29.84-2.03.84Zm13.97-14.9-.96.96-1.94-1.94.96-.96c.27-.27.62-.4.97-.4A1.362 1.362 0 0 1 19.37 6c0 .37-.14.71-.4.97ZM4.03 18.03 15.01 7.05l1.94 1.94L5.97 19.97c-.53.53-1.41.53-1.94 0-.26-.26-.4-.6-.4-.97s.14-.71.4-.97ZM6 11.5a.557.557 0 0 1-.118-.016l-.021-.004-1.36-.4-1.36.4c-.18.05-.36 0-.49-.13a.5.5 0 0 1-.13-.49l.4-1.36-.4-1.36c-.05-.18 0-.37.13-.49s.32-.18.49-.13l1.36.4 1.36-.4a.5.5 0 0 1 .49.13c.13.13.18.32.13.49l-.4 1.36.4 1.36c.05.18 0 .37-.13.49a.47.47 0 0 1-.35.15Zm-1.5-1.44c.044 0 .079.007.12.016l.02.004.62.18-.18-.62a.447.447 0 0 1 0-.28l.18-.62-.62.18c-.09.03-.19.03-.28 0l-.62-.18.18.62c.03.09.03.19 0 .28l-.18.62.62-.18.022-.004a.557.557 0 0 1 .119-.016Zm16.382 6.424a.47.47 0 0 0 .469-.134c.13-.12.18-.31.13-.49l-.4-1.36.4-1.36a.5.5 0 0 0-.13-.49.5.5 0 0 0-.49-.13l-1.36.4-1.36-.4a.523.523 0 0 0-.49.13c-.13.12-.18.31-.13.49l.4 1.36-.4 1.36a.5.5 0 0 0 .13.49c.13.13.31.18.49.13l1.36-.4 1.36.4.021.004Zm-1.262-1.408a.557.557 0 0 0-.12-.016.557.557 0 0 0-.118.016l-.021.004-.62.18.18-.62c.03-.09.03-.19 0-.28l-.18-.62.62.18c.09.03.19.03.28 0l.62-.18-.18.62c-.03.09-.03.19 0 .28l.18.62-.62-.18-.021-.004Z" clip-rule="evenodd"/></svg> 설문지 커스텀하기</a></li> -->
                    <li><a href="group_list.html"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path style="fill:currentColor" fill-rule="evenodd" d="M19.25 17.353a2.75 2.75 0 0 0-2 2.647c0 1.52 1.23 2.75 2.75 2.75s2.75-1.23 2.75-2.75a2.75 2.75 0 0 0-2-2.647V14c0-2.42-1.33-3.75-3.75-3.75h-4.25V6.647a2.75 2.75 0 0 0 2-2.647c0-1.52-1.23-2.75-2.75-2.75S9.25 2.48 9.25 4c0 1.26.845 2.32 2 2.647v3.603H7c-2.42 0-3.75 1.33-3.75 3.75v3.353a2.75 2.75 0 0 0-2 2.647c0 1.52 1.23 2.75 2.75 2.75S6.75 21.52 6.75 20a2.75 2.75 0 0 0-2-2.647V14c0-1.58.67-2.25 2.25-2.25h4.25v5.603a2.75 2.75 0 0 0-2 2.647c0 1.52 1.23 2.75 2.75 2.75s2.75-1.23 2.75-2.75a2.75 2.75 0 0 0-2-2.647V11.75H17c1.58 0 2.25.67 2.25 2.25v3.353ZM4 18.75a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5Zm16 0a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5ZM13.25 4a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0ZM12 18.75a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5Z" clip-rule="evenodd"/></svg> 내 그룹 보기</a></li>
                </ul>
            </nav>
			<a onclick="LOGOUT()" class="bt-logout"><i class="ico i-logout"></i> Logout</a>
        </div>
        <button type="button" class="bt-menu"><span class="skip">메뉴</span></button>
		<div class="member-logout">
			<div class="user_login">
				<figure><img src="../image/common/not_profile.svg" alt="profile"></figure>
				<span><em id="user_name1"></em> <i class="ico"></i></span>
			</div>
            <div class="modal-layer mem_info">
				<figure><img src="../image/common/not_profile.svg" alt=""> <button type="button" onclick="alert('프로필 이미지 등록 버튼 입니다. 필요 시 사용하세요.');"><i class="ico"></i> <span class="skip">프로필 사진 등록</span></button></figure>
				<strong id="user_name2"></strong>
				<a onclick="LOGOUT()" class="bt-logout"><i class="ico i-logout"></i> Logout</a>
                <button type="button" class="bt-close"><span class="skip">닫기</span></button>
            </div>
        </div>
    </header>
	<div id="container">
		<h2 class="sub-tit" id="group_name"></h2>
		<div id="contents" class="group-wrap">
            <ul class="report">
                <li>
                    <i class="ico i-user-fill"></i>
                    <div>
						<p>내 활동 닉네임</p>
						<em id="group_activity_name"></em>
					</div>
                    <a href="#" class="bt-modify" title="닉네임 수정하기"><i class="ico i-pencil"></i> <span class="skip">수정하기</span></a>
                </li>
                <li>
                    <i class="ico"></i>
					<div>
						<p>그룹 인원</p>
						<em id="group_count"></em>
					</div>
                </li>
                <li>
                    <i class="ico i-survey-fill"></i>
					<div>
						<p>공유된 폼 수</p>
						<em id="group_form"></em>
					</div>
                </li>
                <li>
                    <i class="ico i-date-fill"></i>
					<div>
						<p>그룹 생성일</p>
						<em id="group_reg"></em>
					</div>
                </li>
            </ul>
            <div class="group-status-list">
                <div class="tbl-wrap ctm-st2">
                    <table>
                        <caption>그룹 인원 목록</caption>
                        <colgroup><col style="width: 7%" /><col style="width: 25%" /><col style="width: 25%" /><col /><col style="width: 10%" /></colgroup>
                        <thead>
                            <tr>
                                <th scope="col" class="chkbox"><span class="ctm-chk"><input type="checkbox" name="" value="" id="all_remove_chk"><label class="skip">전체선택</label></span></th>
                                <th scope="col" class="name">이름 <button type="button" onlick="alert('링크를 연결하세요!');"><i class="ico i-align"></i><span class="skip">정렬</span></button></th>
                                <th scope="col" class="form">참여한 폼 <button type="button" onlick="alert('링크를 연결하세요!');"><i class="ico i-align"></i><span class="skip">정렬</span></button></th>
                                <th scope="col" class="date">그룹 가입일 <button type="button" onlick="alert('링크를 연결하세요!');"><i class="ico i-align"></i><span class="skip">정렬</span></button></th>
                                <th scope="col" class="detail">상세보기</th>
                            </tr>
                        </thead>
                        <tbody id="group_list">

                        </tbody>
                    </table>
                </div>
                <div class="bt-group">
                    <button type="button" class="st-ico" onclick="groupMemberRemove()"><i class="ico i-trash"></i> <span>그룹원 삭제</span></button>
                    <button type="button" class="st-ico open_modal" onclick=""><span>그룹원 추가</span> <i class="ico i-add"></i></button>
                </div>
            </div>
		</div>
	</div>
</div>
<div class="window_alert frm_alert" id="modal_layer">
	<div class="modal-layer">
		<div class="inner">
			<h2>그룹원 추가하기</h2>
			<form action="">
                <fieldset>
                    <legend>그룹원 추가</legend>
                    <div class="forms-write-wrap">
                        <div class="frm-area">
                            <label for="group_join_url">URL</label>
                            <div class="inp-group">
                                <input type="url" name="" value="" id="group_join_url" class="it" style="pointer-events: none">
                                <button type="button" class="st-fill" data-clipboard-target="#group_join_url" id="url_copy"><span>복사하기</span> <i class="ico i-linkcopy"></i></button>
                            </div>
                        </div>
                        <div class="frm-area">
                            <label for="hp_link">공유하기</label>
                            <div class="inp-group">
                                <input type="text" name="" value="그룹 초대장 공유하기" id="hp_link" class="it" disabled readonly>
                                <button type="button" class="st-fill" onclick="shareURL()"><span>공유하기</span> <i class="ico i-msg-send"></i></button>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
		</div>
		<div class="bt-wrap">
			<button type="button" class="st-ico bt_close"><span>닫기</span></button>
		</div>
	</div>
</div>

<div class="window_alert" id="group_layer">
	<div class="modal-layer">
		<div class="inner">
			<h2>복사 완료</h2>
			<p id="group_comment">그룹에 초대해보세요 !</p>
		</div>
		<div class="bt-wrap">
			<button type="button" class="st-fill" id="close_modal" onclick="closeModal()"><span>확인</span></button>
		</div>
	</div>
</div>
<script src="../js/common/cons.js"></script>
<script src="../js/common.js"></script>
<script src="../js/common/util.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
$(document).ready(function() {
    $('.layer-sel').niceSelect();
    group_my_info();

    $("#all_remove_chk").change(function(){
      if($(this).prop("checked")){
        $(".group_remove_chk").prop("checked", true);
      } else {
        $(".group_remove_chk").prop("checked", false);
      }
    });

    $(document).on('change', '.group_remove_chk', function(){
        var checkboxes = document.querySelectorAll('.group_remove_chk');
        var allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
        if (allChecked) {
            $("#all_remove_chk").prop("checked", true);
        } else {
            if($("#all_remove_chk").prop("checked")) {
                $("#all_remove_chk").prop("checked", false);
            }
        }
    });

});

const group_layer = document.getElementById("group_layer");

function openModal() {
  group_layer.style.display = "flex";
  document.body.style.overflow = "hidden";
}

function closeModal() {
  group_layer.style.display = "none";
  document.body.style.overflow = "auto";
}
var clipboard = new ClipboardJS('#url_copy');

clipboard.on('success', function(e) {
    openModal()
});
function group_my_info() {
    const urlParams = new URLSearchParams(window.location.search);
    const gidValue = urlParams.get('gid');
    const group_session = urlParams.get('group_session');
    if (gidValue && group_session) {
        $.ajax({
            type: 'GET',
            url: 'https://formdang-api.com/api/dj/group/detail',
            data: {gid: gidValue, group_session: group_session},
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('accessToken')
            },
            success: function (response) {
                const data = response.group_my_info
                const list = response.group_info
                $("#group_activity_name").text(data.name);
                $("#group_count").text(`${list.length}명`)
                $("#group_name").append(`${data.group_name} <a href="group_update.html?gid=${data.gid}&group_session=${group_session}" class="bt-modify" title="그룹 수정하기"><i class="ico i-pencil"></i> <span class="skip">수정하기</span></a>`)
                $("#group_form").text(`${data.form_count}개`);
                $("#group_reg").text(`${data.reg_dt}`)
                $("#group_join_url").val(`https://formdang.com/admin/group_login.html?gid=${data.gid}&group_session=${data.url}`)
                if(list.length > 0) {
                    let html = "";
                    for(let i =0; i<list.length; i++) {
                        if(list[i].role == 0) {
                            html += `
                                <tr>
                                    <th scope="row" class="chkbox"><span class="ctm-chk"><input type="checkbox" name="" value="${list[i].gmid}" class="group_remove_chk"><label class="skip">선택</label></span></th>
                                    <td class="name">${list[i].name}</td>
                                    <td class="form">${list[i].form_count}</td>
                                    <td class="date">${String(list[i].reg_dt).replace("T", " ")}</td>
                                    <td class="detail"><a href="javascript:alert('링크를 연결하세요!');"><span class="skip">상세보기</span> <i class="ico i-answer-view"></i></a></td>
                                </tr>
                            `
                        }
                    }
                    if ([null, undefined, ''].includes(html)) {
                        html += `
                            <th scope="row" colspan="5">그룹에 초대된 인원이 없습니다.</th>
                        `
                    }
                    $("#group_list").append(html);
                }
            },
            error: function (error) {
                alert("유효하지 않은 그룹입니다.");
                location.replace("index.html");
                console.error('AJAX 요청 실패:', error);
            }
        });
    }else {
        alert("유효하지 않은 그룹입니다.");
        location.replace("index.html");
    }
}


function shareURL() {
  const urlToShare = $("#group_join_url").val();
  const textToShare = $("#group_activity_name").text()
  if (navigator.share) {
    navigator.share({
      title: '폼당폼당 그룹초대',
      text: `${textToShare}님의 그룹 초대장`,
      url: urlToShare
    })
    .then(() => console.log('그룹 초대'))
    .catch((error) => console.error('공유 중 오류 발생:', error));
  } else {
    alert('해당 브라우저에서는 공유가 지원되지 않습니다.\n복사하기를 이용해주세요 !');
    return false;
  }
}


function groupMemberRemove() {
      var selectedValues = [];
      $(".group_remove_chk:checked").each(function(){
        selectedValues.push($(this).val());
      });
      console.log(selectedValues);
}
</script>
</body>
</html>
